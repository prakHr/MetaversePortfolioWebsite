<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/sankey.js"></script>
    <script src="https://code.highcharts.com/modules/arc-diagram.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
	<link rel="stylesheet" type="text/css" href="../css/style.css">
	<title>>>> V.I.S.I.O.N >>></title>
	
    <script src= 
    "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  
    
</head>
<body>
	<h1>Machine Learning based Inventory....</h1>
	<div style="text-align: center;" class="BTN5">
	<h1>TEXT PRODUCTS</h1>
	<button id="BTN5">Product 5</button>

	<div class="mb8" id="BTNCLASS5">
		<input type="text" name="autoS" id="autoS" style="height: 200px; width: 1000px;" placeholder="Enter your sentence to be searched For example I am sitting in airplane."></input>
		<br>
		<button id="autosearchBtn" style="background-color:purple;color: white;height: 25px;border: 1px solid blueviolet;border-radius: 10px;">Auto Search Sentence</button>
        <button id="clrsearchBtn" style="background-color:purple;color: white;height: 25px;border: 1px solid blueviolet;border-radius: 10px;">Clear Wiki Searches</button>
        		

        <!-- Load d3.js -->
        <script src="https://d3js.org/d3.v4.js"></script>

        <!-- Create a div where the graph will take place -->
        <div id="my_dataviz"></div>
		<!-- <script src="../js/autosearchApp.js"></script>
 -->
		<script>
            var searchBtn = document.getElementById("clrsearchBtn")
            searchBtn.addEventListener('click', function(){
                $('.akm').remove();
            });
			const btn5 = document.getElementById("BTN5");
			
			btn5.addEventListener("click",function(){
				var div = document.getElementById("BTNCLASS5");
				div.style.display= div.style.display == "none" ? "block" : "none";
				// console.log(div);
				
			});
			
		</script>
         <div id="viz" style="height: 700px; max-width: 800px; margin: 0 auto;"></div>
        
    <script type="module">

        import winkNlp from 'https://cdn.skypack.dev/wink-nlp';
        import winkEngLiteWebModel from 'https://cdn.skypack.dev/wink-eng-lite-web-model';
        import fastDiceCoefficient from 'https://cdn.jsdelivr.net/npm/fast-dice-coefficient@1.0.3/+esm'
        // Create the svg area
        d3.selectAll("svg > *").remove();
            
        
        const getTags = (data) => {
            const nlp = winkNlp(winkEngLiteWebModel);
            let its = nlp.its;
            let as = nlp.as;
            const doc = nlp.readDoc(data);
            const result = doc.tokens().out(its.pos);
            return result;
        }

        const getCleanedTerms = (data) => {
            let punctuation = '!"#$%&\()*+,./:;<=>?@[\\]^_`{|}~';
            let regex = new RegExp("[" + punctuation + "]", "g");
            let result = data.split(" ").map(
                d => d
                .replace(regex, "")
                .toLowerCase()
                    );
            return result.join(" ");
        }

        const getCoOccurrence = (data,howmany) => {
            let result = new Array();
            for (let i = 0; i < data.length; i++) {
                if (typeof data[i + howmany] === "string") {
                result.push(`${data[i]} ${data[i+howmany]}`);
                }
            }
            return result;
        }

        const getCount = (data) => {
            let temp = new Object();
            let result = new Array();
            for (let d of data) {
                if (temp[d]) {
                temp[d] += 1;
                }
                else {
                temp[d] = 1;
                } 
            }
            for (let t in temp) {
                result.push( [t.split(" ")[0], t.split(" ")[1],temp[t]] );
            }
            return result;
        }

        const getChart = (data,chart_title) => {
            Highcharts.chart(
                "viz",
                {
                    //colors: ["#003f5c","#58508d","#58508d","#ff6361","#ffa600"],
                    //colors: ["#cdb4db","#ffc8dd","#ffafcc","#bde0fe","#a2d2ff"],
                    colors: ["#3A98B9","#FFF1DC","#E8D5C4","#EEEEEE"],
                    title: {
                        text: chart_title
                    },
                    series: [{
                    keys: ["from", "to", "weight"],
                    type: "arcdiagram",
                    name: "Ngrams",
                    linkWeight: 1,
                    centeredLinks: true,
                    dataLabels: {
                        rotation: 90,
                        y: 110,
                        align: 'left',
                        color: 'black'
                        },
                    offset: '65%',
                    data: data
                }]
                }
            )
        }
        var btnn = document.getElementById('autosearchBtn');
        btnn.addEventListener('click', function(){
            var text = document.getElementById('autoS').value;
            
            var cleaned = getCleanedTerms(text);
            var nlp = winkNlp(winkEngLiteWebModel);
            var its = nlp.its;
            var doc = nlp.readDoc(cleaned);
            var entities = doc.entities().out(its.detail);
             
            for(var i=0;i<entities.length;i++){
                
                var query = entities[i].value;
                // var url = `https://en.wikipedia.org/w/api.php?action=opensearch&search="+ ${query} +"&format=json`

                fetch(`https://en.wikipedia.org/w/api.php?&origin=*&action=opensearch&search=${query}&limit=5`)
                .then(function(resp) {
                    // console.log(resp);
                    return resp.json();
                })
                .then(function(data) {
                    // console.log(data);
                    var para = document.createElement(`p-${i}`);
                    var htmlContent = "";
                    var aa = [];
                    var bb = [];
                    for(var i=1;i<data.length;i++){
                        var ele = data[i];
                        // console.log("ele");
                        // console.log(ele);
                        for(var j=0;j<ele.length;j++)
                        {   
                            // console.log(i);
                            // console.log("ele[j]");
                            // console.log(ele[j]);  
                            if(i==1)
                            {
                                aa.push(ele[j]);
                                // htmlContent+=`<div>${ele[j]}</div>`
                            }
                            if(i==3){
                                bb.push(ele[j]);
                                // htmlContent+=`<a href="${ele[j]}">${ele[j]}<br></a>`   
                            }
                            
                        }
                        // console.log(data[i]);
                    }
                    for(var i=0;i<aa.length;i++){
                        htmlContent+=`<div class="akm"><div>${aa[i]}</div><a href="${bb[i]}">${bb[i]}<br><br><br><br></a></div>`
                    }
                    para.innerHTML = htmlContent;
                    document.body.appendChild(para);
                })
                
            }
            var tokens = getTags(cleaned);

            var occurrence = getCoOccurrence(tokens,1);
            var c = getCount(occurrence);
            // console.log(c);
            getChart(c,"Semantic proximity between POS tags");


            // Graph dimension
            var margin = {top: 20, right: 20, bottom: 20, left: 20},
                width = 430 - margin.left - margin.right,
                height = 430 - margin.top - margin.bottom

            var svg = d3.select("#my_dataviz")
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


            
              var data = [];
              var ts = c;
              for(var t1=0;t1<ts.length;t1++){
                data.push({
                    x:ts[t1][0],
                    y:ts[t1][1],
                    value:ts[t1][2]
                })
                
              }

              // console.log(data);

              // List of all variables and number of them
              var domain = d3.set(data.map(function(d) { return d.x })).values()
              var num = Math.sqrt(data.length)

              // Create a color scale
              var color = d3.scaleLinear()
                .domain([-1, 0, 1])
                .range(["#B22222", "#fff", "#000080"]);

              // Create a size scale for bubbles on top right. Watch out: must be a rootscale!
              var size = d3.scaleSqrt()
                .domain([0, 1])
                .range([0, 9]);

              // X scale
              var x = d3.scalePoint()
                .range([0, width])
                .domain(domain)

              // Y scale
              var y = d3.scalePoint()
                .range([0, height])
                .domain(domain)

              // Create one 'g' element for each cell of the correlogram
              var cor = svg.selectAll(".cor")
                .data(data)
                .enter()
                .append("g")
                  .attr("class", "cor")
                  .attr("transform", function(d) {
                    return "translate(" + x(d.x) + "," + y(d.y) + ")";
                  });

              // Low left part + Diagonal: Add the text with specific color
              cor
                .filter(function(d){
                  var ypos = domain.indexOf(d.y);
                  var xpos = domain.indexOf(d.x);
                  return xpos <= ypos;
                })
                .append("text")
                  .attr("y", 5)
                  .text(function(d) {
                    if (d.x === d.y) {
                      return d.x;
                    } else {
                      return d.value.toFixed(2);
                    }
                  })
                  .style("font-size", 11)
                  .style("text-align", "center")
                  .style("fill", function(d){
                    if (d.x === d.y) {
                      return "#000";
                    } else {
                      return color(d.value);
                    }
                  });


              // Up right part: add circles
              cor
                .filter(function(d){
                  var ypos = domain.indexOf(d.y);
                  var xpos = domain.indexOf(d.x);
                  return xpos > ypos;
                })
                .append("circle")
                  .attr("r", function(d){ return size(Math.abs(d.value)) })
                  .style("fill", function(d){
                    if (d.x === d.y) {
                      return "#000";
                    } else {
                      return color(d.value);
                    }
                  })
                  .style("opacity", 0.8)

            })

    </script>
		 	
		<br><br><br>
	</div>

    <div style="text-align: center;" class="BTN6">
    <button id="BTN6">Product 6</button>

    <div class="mb8" id="BTNCLASS6">
        <label><input type="checkbox" name="preference" value="business">business</label>
      <label><input type="checkbox" name="preference" value="education">education</label>
      <label><input type="checkbox" name="preference" value="faith">faith</label>
      <label><input type="checkbox" name="preference" value="friendship">friendship</label>
      <label><input type="checkbox" name="preference" value="future">future</label>
      <select id="ratingDropdown">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
        <div id="quote"></div>
        <button id="generateRandomQuote"> Generate Random Quote</button>
        <button id="submitRating"> Submit Rating</button>
        <div id="recommend"></div>
    </div>
    <script src="https://unpkg.com/brain.js"></script>
    <script>
        var aa = 0;
        // provide optional config object (or undefined). Defaults shown.
        const config = {
          binaryThresh: 0.5,
          hiddenLayers: [3], // array of ints for the sizes of the hidden layers in the network
          activation: 'sigmoid', // supported activation types: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
          leakyReluAlpha: 0.01, // supported for activation type 'leaky-relu'
        };
        // create a simple feed-forward neural network with backpropagation
        const net = new brain.NeuralNetwork(config);
        const btn6 = document.getElementById("BTN6");
            
        btn6.addEventListener("click",function(){
            var div = document.getElementById("BTNCLASS6");
            div.style.display= div.style.display == "none" ? "block" : "none";
                // console.log(div);
                
        });
            

    </script>
    <script>
        var btnnn = document.getElementById("generateRandomQuote");

        var btnnr = document.getElementById("submitRating");
        
        async function getTags(selectedPreferences){
            if(selectedPreferences.length<=1){
                return selectedPreferences[0]
            }
            var tags = "";
            for(var i=0;i<selectedPreferences.length-1;i+=1){
                
                tags+=selectedPreferences[i]+"|";
            }
            tags+=selectedPreferences[i];
            return tags;
        }
        async function randomQuote(selectedPreferences) {
            const tags = await getTags(selectedPreferences);
            // console.log(tags);
            const response = await fetch(`https://api.quotable.io/quotes?tags=${tags}`)
            const quotes = await response.json()
            // console.log(quotes)
            const quote = quotes['results'][0]['content']
            document.getElementById('quote').innerText = quote;
            // console.log(quote)
            return quote
        }
        btnnn.addEventListener('click', function(){
            
            var selectedPreferences = []; // Clear the array
            const radioButtons = document.querySelectorAll('input[type="checkbox"]');
            radioButtons.forEach(radioButton => {
              if (radioButton.checked) {
                selectedPreferences.push(radioButton.value); // Add checked value to the array
              }
            });
            var inp  = [];
            // console.log(selectedPreferences);
            randomQuote(selectedPreferences);
            
            
        })
        btnnr.addEventListener('click', function(){
            aa+=1;
            // console.log(aa);
            
            var selectedPreferences = []; // Clear the array
            const radioButtons = document.querySelectorAll('input[type="checkbox"]');
            radioButtons.forEach(radioButton => {
              if (radioButton.checked) {
                selectedPreferences.push(radioButton.value); // Add checked value to the array
              }
            });
            var inp  = [];
            // console.log(selectedPreferences);
            // randomQuote(selectedPreferences);
            const ratingDropdown = document.getElementById('ratingDropdown').value;

            var outp = [ratingDropdown];
            var allPreferences = ["business","education","faith","friendship","future"]
            function present(x,arr){
            
                for(var i=0;i<arr.length;i++){
                    if(x==arr[i]){
                        return true;
                    }
                }
                return false;
            }
            for(var i=0;i<allPreferences.length;i++){
                if(present(allPreferences[i],selectedPreferences)){
                    inp.push(1);
                }else{
                    inp.push(0);
                }
            };
            // console.log(inp);
            // console.log(Number(outp));
            const outpp = [(Number(outp))/5];
            const json_data = {input:inp,output:outpp};
            // console.log(json_data)
            net.train([json_data]);
            if(aa>=10){
                var predictedRating = net.run(inp);
                // console.log("here");
                var Pred = Math.ceil(predictedRating*5);
                document.getElementById('recommend').innerText = `Predicted Rating = ${Pred}`;
            
            }
            
        })
    </script>
    <script src="webcam.js"></script>
    <script src="rps-dataset.js"></script>

    <div style="text-align: center;" class="BTN7">
        <h1>VISION PRODUCTS</h1>
        <button id="BTN7">Product 7</button>

        <div class="mb8" id="BTNCLASS7">
            <div>
                <div>
                    <video autoplay playsinline muted id="wc" width="224" height="224"></video>
                </div>
            </div>
            <button type="button" id="0" onclick="handleButton(this)" >Click to get Sample 1</button>
            <button type="button" id="1" onclick="handleButton(this)" >Click to get Sample 2</button>
            <button type="button" id="2" onclick="handleButton(this)" >Click to get Sample 3</button>
            <button type="button" id="3" onclick="handleButton(this)" >Click to get Sample 4</button>
            <!-- <button type="button" id="4" onclick="handleButton(this)" >Lizard</button> -->
            <div id="rocksamples">Predicted Image1:</div>
            <div id="papersamples">Predicted Image2:</div>
            <div id="scissorssamples">Predicted Image3:</div>
            <div id="spocksamples">Predicted Image4:</div>
            <button type="button" id="train" onclick="doTraining()" >Train Network</button>
            <div id="dummy">Once training is complete, click 'Start Predicting' to see predictions, and 'Stop Predicting' to end. Once you are happy with your model, click 'Download Model' to save the model to your local disk.</div>
            <button type="button" id="startPredicting" onclick="startPredicting()" >Start Predicting</button>
            <button type="button" id="stopPredicting" onclick="stopPredicting()" >Stop Predicting</button>
            <button type="button" id="saveModel" onclick="saveModel()" >Download Model</button>
            <div id="prediction"></div>
            <button onclick="prev()" style="color:white;background-color:purple;border:2px solid white;border-radius: 8px;">prev</button>
            <img src="../images/sc.jpg" alt="" style="width:500px; height: 400px;" id="carimg">
            <button id="carbtn" onclick="next()" style="color:white;background-color:purple;border:2px solid white;border-radius: 8px;">Next</button>

        </div>
        
        

    </div>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js">
    </script>
    <script>
        const btn7 = document.getElementById("BTN7");
            
        btn7.addEventListener("click",function(){
            var div = document.getElementById("BTNCLASS7");
            div.style.display= div.style.display == "none" ? "block" : "none";
                
                
        });
        var photos = ["../images/mp.jpg","../images/sc.jpg"]

        var imgTag = document.getElementById("carimg");
        var count = 0;

        function next(){
            count++;
            if(count >= photos.length){
                count = 0;
                imgTag.src = photos[count];
            }else{
                imgTag.src = photos[count];
            }
        }

        function prev(){
            count--;
            if(count < 0){
                count = photos.length -1;
                imgTag.src = photos[count];
            }else{
                imgTag.src = photos[count];
            }
        }
            
    </script>

    <script src="index_exercise.js"></script>
    
</body>
</html>